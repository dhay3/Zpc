# Do not use that configuration as an extend config or extend script when a profile has been 
# selected that the profile's subscription url is in the $.proxy-provider.url list. If so the proxy
# nodes will be duplicated in proxies panel in Clash Verge Rev, Create a new local profile which
# contains this configuration and selected it. Or add a blank local profile to avoid it
#
# https://wiki.metacubex.one/config/

#>>> Yaml Aliases Start >>>
healthCheck: &healthCheck
  url: "http://www.gstatic.com/generate_204"
  lazy: true
  interval: 600
  timeout: 5000
proxy-providers-options:
  proxyProvidersCommon: &proxyProvidersCommon
    type: http
    interval: 3600
    health-check:
      enable: true
      <<: *healthCheck
rule-providers-options:
  ruleProvidersCommon: &ruleProvidersCommon
    type: http
    format: yaml
    interval: 10368000
proxy-groups-options:
  proxyGroupsCommon: &proxyGroupsCommon
    <<: *healthCheck
    max-failed-times: 3
    include-all: true
    #include-all-proxies: false
    #include-all-providers: false
  proxyGroupsUse: &proxyGroupsUse
    use:
      - sub1
      - sub2
    <<: *proxyGroupsCommon
  proxyGroupsProxies: &proxyGroupsProxies
    proxies:
      - "ğŸ‡¦ğŸ‡º AU"
      - "ğŸ‡¨ğŸ‡¦ CA"
      - "ğŸ‡©ğŸ‡ª DE"
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡®ğŸ‡³ IN"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡°ğŸ‡· KR"
      - "ğŸ‡²ğŸ‡´ MA"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡µğŸ‡­ PH"
      - "ğŸ‡·ğŸ‡º RU"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¹ğŸ‡· TR"
      - "ğŸ‡¬ğŸ‡§ UK"
      - "ğŸ‡ºğŸ‡¸ US"
  proxyGroupsProxiesCombined: &proxyGroupsProxiesCombined
    proxies:
      - "ğŸŒ DIRECT"
      - "ğŸš« REJECT"
      - "ğŸ«´ Manual"
      - "ğŸ‡¦ğŸ‡º AU"
      - "ğŸ‡¨ğŸ‡¦ CA"
      - "ğŸ‡©ğŸ‡ª DE"
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡®ğŸ‡³ IN"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡°ğŸ‡· KR"
      - "ğŸ‡²ğŸ‡´ MA"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡µğŸ‡­ PH"
      - "ğŸ‡·ğŸ‡º RU"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¹ğŸ‡· TR"
      - "ğŸ‡¬ğŸ‡§ UK"
      - "ğŸ‡ºğŸ‡¸ US"
#<<< Yaml Aliases End <<<

#>>> Genernal Configuration Start >>>
# Do not use default port for security concern 
bind-address: "*"
mixed-port: 37897
redir-port: 37898
tproxy-port: 37899
external-controller: 0.0.0.0:9090
log-level: silent
allow-lan: false
ipv6: false
unified-delay: true
tcp-concurrent: true
keep-alive-interval: 300
global-client-fingerprint: random
global-ua: clash.meta
profile:
  store-selected: true
  store-fake-ip: true
#<<< Genernal Configuration End <<<

#>>> GEO Configuration Start >>>
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 168
geox-url:
  geoip: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  asn: "https://hub.gitmirror.com/https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"
#<<< GEO Configuration End <<<

#>>> TUN/TAP Configuration Start >>>
tun:
  enable: true
  stack: mixed
  device: Meta
  auto-route: true
  auto-detect-interface: true
  strict-route: true
  dns-hijack:
    - any:53
  mtu: 1500
#<<< TUN/TAP Configuration End <<<

#>>> Domain Sniffing Configuration Start >>>
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80]
    TLS:
      ports: [443]
    QUIC:
      ports: [443]
  skip-domain:
    - '+.lan'
    - '+.local'
    - '+.localhost'
    - '+.home'
#<<< Domain Sniffing Configuration End <<<

#>>> DNS Configuration Start >>>
dns:
  enable: true
  prefer-h3: true
  ipv6: false
  use-hosts: true
  use-system-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.40.0.1/16
  fake-ip-filter:
    - '+.lan'
    - '+.local'
    - '+.localhost'
    - '+.home'
  # Default DNS nameservers for all requests
  nameserver:
    - https://223.5.5.5/dns-query
  # DNS nameservers for Proxies
  proxy-server-nameserver:
    - https://208.67.220.220/dns-query
  # DNS nameservers for NS records
  default-nameserver:
    - 223.5.5.5
    - 208.67.220.220
  # Fallback nameserver for requests that do not matched fallback-filter
  fallback:
    - https://208.67.220.220/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN
  nameserver-policy:
    '+.openwrt.home': '192.168.2.1'
    '+.nas.home': '192.168.2.1'
    '+.rack.home': '192.168.2.1'
#<<< DNS Configuration End <<<

#>>> Proxy Providers Configuration Start >>>
# Replace url with your subscription
proxy-providers:
  sub1:
    <<: *proxyProvidersCommon
    url: "https://sub1-example.org"
    path: ./proxy_providers/sub1.yaml
    proxy: "ğŸ‡­ğŸ‡° HK"
  sub2:
    <<: *proxyProvidersCommon
    url: "https://sub2-example.org"
    path: ./proxy_providers/sub2.yaml
    proxy: "ğŸ‡­ğŸ‡° HK"
#<<< Proxy Providers Configuration End <<<

#>>> Rule Providers Configuration Start >>>
# https://github.com/Loyalsoldier/clash-rules
# https://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Clash
rule-providers:
  claude:
    <<: *ruleProvidersCommon
    behavior: domain
    url: "https://github.com/blackmatrix7/ios_rule_script/raw/release/rule/Clash/Claude/Claude.yaml"
    path: ./ruleset/Claude.yaml
#<<< Rule Providers Configuration End <<<

#>>> Proxy Groups(Policy) Configuration Start >>>
proxy-groups:
  - name: "ğŸŒ DIRECT"
    type: select
    proxies:
      - DIRECT
  - name: "ğŸš« REJECT"
    type: select
    proxies:
      - REJECT
  - name: "ğŸ‡¦ğŸ‡· AR"
    <<: *proxyGroupsUse
    type: select
    filter: "(?i)ğŸ‡¦ğŸ‡·|é˜¿æ ¹å»·|argentina"
  - name: "ğŸ‡¦ğŸ‡º AU"
    <<: *proxyGroupsUse
    type: select
    filter: "(?i)ğŸ‡¦ğŸ‡º|æ¾³å¤§åˆ©äºš|æ¾³å¤§åˆ©äº|australia"
  - name: "ğŸ‡¨ğŸ‡¦ CA"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡¨ğŸ‡¦|åŠ æ‹¿å¤§|canada"
  - name: "ğŸ‡©ğŸ‡ª DE"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡©ğŸ‡ª|å¾·å›½|å¾·åœ‹|æŸæ—|æ…•å°¼é»‘|germany"
  - name: "ğŸ‡­ğŸ‡° HK"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡­ğŸ‡°|é¦™æ¸¯|hongkong"
  - name: "ğŸ‡®ğŸ‡³ IN"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡®ğŸ‡³|å°åº¦|india"
  - name: "ğŸ‡¯ğŸ‡µ JP"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|japan"
  - name: "ğŸ‡°ğŸ‡· KR"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡°ğŸ‡·|éŸ©å›½|éŸ“åœ‹|korean"
  - name: "ğŸ‡²ğŸ‡´ MA"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡²ğŸ‡´|æ¾³é—¨|æ¾³é–€|maco"
  - name: "ğŸ‡²ğŸ‡¾ MY"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡²ğŸ‡¾|é©¬æ¥è¥¿äºš|é¦¬ä¾†è¥¿äº|malaysia"
  - name: "ğŸ‡µğŸ‡­ PH"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡µğŸ‡­|è²å¾‹å®¾|è²å¾‹è³“|philippines"
  - name: "ğŸ‡·ğŸ‡º RU"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡·ğŸ‡º|ä¿„ç½—æ–¯|ä¿„ç¾…æ–¯|russia"
  - name: "ğŸ‡¸ğŸ‡¬ SG"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|singapore"
  - name: "ğŸ‡¹ğŸ‡¼ TW"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡¹ğŸ‡¼|å°æ¹¾|è‡ºç£|taiwan"
  - name: "ğŸ‡¹ğŸ‡· TR"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡¹ğŸ‡·|åœŸè€³å…¶|turkey"
  - name: "ğŸ‡¬ğŸ‡§ UK"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡¬ğŸ‡§|è‹±|è‹±åœ‹|england|kingdom|britsh"
  - name: "ğŸ‡ºğŸ‡¸ US"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)ğŸ‡ºğŸ‡¸|ç¾å›½|ç¾åœ‹|è¥¿é›…å›¾|è¥¿é›…åœ–|æ´›æ‰çŸ¶|æ´›æ‰ç£¯|è‰¾æ–¯æœ¬|america|states|seattle|angeles|ashburn"
  - name: "ğŸš˜ Auto"
    type: url-test
    tolerance: 100
    max-failed-times: 3
    <<: *proxyGroupsProxies
  - name: "ğŸ”™ Fallback"
    type: fallback
    url: 'https://www.gstatic.com/generate_204'
    max-failed-times: 3
    <<: *proxyGroupsProxies
  - name: "ğŸ“ Relay"
    type: relay
    proxies:
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡ºğŸ‡¸ US"
  - name: "ğŸ«´ Manual"
    type: select
    proxies:
      - "ğŸŒ DIRECT"
      - "ğŸš« REJECT"
      - "ğŸ‡¦ğŸ‡º AU"
      - "ğŸ‡¨ğŸ‡¦ CA"
      - "ğŸ‡©ğŸ‡ª DE"
      - "ğŸ‡­ğŸ‡° HK"
      - "ğŸ‡®ğŸ‡³ IN"
      - "ğŸ‡¯ğŸ‡µ JP"
      - "ğŸ‡°ğŸ‡· KR"
      - "ğŸ‡²ğŸ‡´ MA"
      - "ğŸ‡²ğŸ‡¾ MY"
      - "ğŸ‡µğŸ‡­ PH"
      - "ğŸ‡·ğŸ‡º RU"
      - "ğŸ‡¸ğŸ‡¬ SG"
      - "ğŸ‡¹ğŸ‡¼ TW"
      - "ğŸ‡¹ğŸ‡· TR"
      - "ğŸ‡¬ğŸ‡§ UK"
      - "ğŸ‡ºğŸ‡¸ US"
  - name: "ğŸ”Š ADS"
    type: select
    proxies:
      - "ğŸŒ DIRECT"
      - "ğŸš« REJECT"
      - "ğŸ«´ Manual"
  - name: "ğŸ¤– AI"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ Apple"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ‡¬ Google"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ§ª YouTube"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ¥… Netflix"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ­ Disney"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ‘Œ HBO"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ§™ğŸ¿â€â™€ï¸ Twitch"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ¦ Twitter"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ“² Telegram"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸš‚ Steam"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸªŸ Microsoft"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ“ˆ Speedtest"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸ‘‚ Spotify"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸªœ Proxy"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ğŸŸ Leakage"
    type: select
    <<: *proxyGroupsProxiesCombined
#<<< Proxy Groups(Policy) Configuration End <<<

#>>> Rules Configuration End >>>
rules:
  - GEOIP,PRIVATE,ğŸŒ DIRECT
  - GEOSITE,private,ğŸŒ DIRECT
  - GEOSITE,category-ads-all,ğŸ”Š ADS
  - GEOSITE,google,ğŸ‡¬ Google
  - GEOSITE,youtube,ğŸ§ª YouTube
  - GEOSITE,netflix,ğŸ¥… Netflix
  - GEOSITE,disney,ğŸ­ Disney
  - GEOSITE,hbo,ğŸ‘Œ HBO
  - GEOSITE,openai,ğŸ¤– AI
  - RULE-SET,claude,ğŸ¤– AI
  - GEOSITE,twitch,ğŸ§™ğŸ¿â€â™€ï¸ Twitch
  - GEOSITE,twitter,ğŸ¦ Twitter
  - GEOSITE,telegram,ğŸ“² Telegram
  - GEOSITE,speedtest,ğŸ“ˆ Speedtest
  - GEOSITE,spotify,ğŸ‘‚ Spotify
  - GEOSITE,microsoft@cn,ğŸŒ DIRECT
  - GEOSITE,microsoft,ğŸªŸ Microsoft
  - GEOSITE,apple@cn,ğŸŒ DIRECT
  - GEOSITE,apple,ğŸ Apple
  - GEOSITE,steam@cn,ğŸŒ DIRECT
  - GEOSITE,steam,ğŸš‚ Steam
  - GEOSITE,bilibili,ğŸ«´ Manual
  - GEOSITE,zhihu,ğŸ«´ Manual
  - GEOSITE,douban,ğŸ«´ Manual
  - GEOSITE,geolocation-!cn,ğŸªœ Proxy
  - GEOSITE,cn,ğŸŒ DIRECT
  - GEOIP,CN,ğŸŒ DIRECT
  - MATCH,ğŸŸ Leakage
#<<< Rules Configuration End <<<
