# Do not use that configuration as an extend config or extend script when a profile has been 
# selected that the profile's subscription url is in the $.proxy-provider.url list. If so the proxy
# nodes will be duplicated in proxies panel in Clash Verge Rev, Create a new local profile which
# contains this configuration and selected it. Or add a blank local profile to avoid it
#
# https://wiki.metacubex.one/config/

#>>> Yaml Aliases Start >>>
healthCheck: &healthCheck
  url: "http://www.gstatic.com/generate_204"
  lazy: true
  interval: 600
  timeout: 5000
proxy-providers-options:
  proxyProvidersCommon: &proxyProvidersCommon
    type: http
    interval: 3600
    health-check:
      enable: true
      <<: *healthCheck
rule-providers-options:
  ruleProvidersCommon: &ruleProvidersCommon
    type: http
    format: yaml
    interval: 10368000
proxy-groups-options:
  proxyGroupsCommon: &proxyGroupsCommon
    <<: *healthCheck
    max-failed-times: 3
    include-all: true
    #include-all-proxies: false
    #include-all-providers: false
  proxyGroupsUse: &proxyGroupsUse
    use:
      - sub1
      - sub2
    <<: *proxyGroupsCommon
  proxyGroupsProxies: &proxyGroupsProxies
    proxies:
      - "üá¶üá∫ AU"
      - "üá®üá¶ CA"
      - "üá©üá™ DE"
      - "üá≠üá∞ HK"
      - "üáÆüá≥ IN"
      - "üáØüáµ JP"
      - "üá∞üá∑ KR"
      - "üá≤üá¥ MA"
      - "üá≤üáæ MY"
      - "üáµüá≠ PH"
      - "üá∑üá∫ RU"
      - "üá∏üá¨ SG"
      - "üáπüáº TW"
      - "üáπüá∑ TR"
      - "üá¨üáß UK"
      - "üá∫üá∏ US"
  proxyGroupsProxiesCombined: &proxyGroupsProxiesCombined
    proxies:
      - "üåê DIRECT"
      - "üö´ REJECT"
      - "ü´¥ Manual"
      - "üá¶üá∫ AU"
      - "üá®üá¶ CA"
      - "üá©üá™ DE"
      - "üá≠üá∞ HK"
      - "üáÆüá≥ IN"
      - "üáØüáµ JP"
      - "üá∞üá∑ KR"
      - "üá≤üá¥ MA"
      - "üá≤üáæ MY"
      - "üáµüá≠ PH"
      - "üá∑üá∫ RU"
      - "üá∏üá¨ SG"
      - "üáπüáº TW"
      - "üáπüá∑ TR"
      - "üá¨üáß UK"
      - "üá∫üá∏ US"
#<<< Yaml Aliases End <<<

#>>> Genernal Configuration Start >>>
# Do not use default port for security concern 
bind-address: "*"
mixed-port: 37897
redir-port: 37898
tproxy-port: 37899
external-controller: 0.0.0.0:9090
log-level: silent
allow-lan: false
ipv6: false
unified-delay: true
tcp-concurrent: true
keep-alive-interval: 300
global-client-fingerprint: random
global-ua: clash.meta
profile:
  store-selected: true
  store-fake-ip: true
#<<< Genernal Configuration End <<<

#>>> GEO Configuration Start >>>
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 168
geox-url:
  geoip: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  asn: "https://hub.gitmirror.com/https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"
#<<< GEO Configuration End <<<

#>>> TUN/TAP Configuration Start >>>
tun:
  enable: true
  stack: mixed
  device: Meta
  auto-route: true
  auto-detect-interface: true
  strict-route: true
  dns-hijack:
    - any:53
  mtu: 1500
#<<< TUN/TAP Configuration End <<<

#>>> Domain Sniffing Configuration Start >>>
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80]
    TLS:
      ports: [443]
    QUIC:
      ports: [443]
  skip-domain:
    - '+.lan'
    - '+.local'
    - '+.localhost'
    - '+.home'
#<<< Domain Sniffing Configuration End <<<

#>>> DNS Configuration Start >>>
dns:
  enable: true
  prefer-h3: true
  ipv6: false
  use-hosts: true
  use-system-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.40.0.1/16
  fake-ip-filter:
    - '+.lan'
    - '+.local'
    - '+.localhost'
    - '+.home'
  # Default DNS nameservers for all requests
  nameserver:
    - https://223.5.5.5/dns-query
  # DNS nameservers for Proxies
  proxy-server-nameserver:
    - https://208.67.220.220/dns-query
  # DNS nameservers for NS records
  default-nameserver:
    - 223.5.5.5
    - 208.67.220.220
  # Fallback nameserver for requests that do not matched fallback-filter
  fallback:
    - https://208.67.220.220/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN
  nameserver-policy:
    '+.openwrt.home': '192.168.2.1'
    '+.nas.home': '192.168.2.1'
    '+.rack.home': '192.168.2.1'
#<<< DNS Configuration End <<<

#>>> Proxy Providers Configuration Start >>>
# Replace url with your subscription
proxy-providers:
  sub1:
    <<: *proxyProvidersCommon
    url: "https://sub1-example.org"
    path: ./proxy_providers/sub1.yaml
    proxy: "üá≠üá∞ HK"
  sub2:
    <<: *proxyProvidersCommon
    url: "https://sub2-example.org"
    path: ./proxy_providers/sub2.yaml
    proxy: "üá≠üá∞ HK"
#<<< Proxy Providers Configuration End <<<

#>>> Rule Providers Configuration Start >>>
# https://github.com/Loyalsoldier/clash-rules
# https://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Clash
rule-providers:
  claude:
    <<: *ruleProvidersCommon
    behavior: domain
    url: "https://github.com/blackmatrix7/ios_rule_script/raw/release/rule/Clash/Claude/Claude.yaml"
    path: ./ruleset/Claude.yaml
#<<< Rule Providers Configuration End <<<

#>>> Proxy Groups(Policy) Configuration Start >>>
proxy-groups:
  - name: "üåê DIRECT"
    type: select
    proxies:
      - DIRECT
  - name: "üö´ REJECT"
    type: select
    proxies:
      - REJECT
  - name: "üá¶üá∑ AR"
    <<: *proxyGroupsUse
    type: select
    filter: "(?i)üá¶üá∑|ÈòøÊ†πÂª∑|argentina"
  - name: "üá¶üá∫ AU"
    <<: *proxyGroupsUse
    type: select
    filter: "(?i)üá¶üá∫|Êæ≥Â§ßÂà©‰∫ö|Êæ≥Â§ßÂà©‰∫û|australia"
  - name: "üá®üá¶ CA"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá®üá¶|Âä†ÊãøÂ§ß|canada"
  - name: "üá©üá™ DE"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá©üá™|Âæ∑ÂõΩ|Âæ∑Âúã|ÊüèÊûó|ÊÖïÂ∞ºÈªë|germany"
  - name: "üá≠üá∞ HK"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá≠üá∞|È¶ôÊ∏Ø|hongkong"
  - name: "üáÆüá≥ IN"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üáÆüá≥|Âç∞Â∫¶|india"
  - name: "üáØüáµ JP"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üáØüáµ|Êó•Êú¨|japan"
  - name: "üá∞üá∑ KR"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá∞üá∑|Èü©ÂõΩ|ÈüìÂúã|korean"
  - name: "üá≤üá¥ MA"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá≤üá¥|Êæ≥Èó®|Êæ≥ÈñÄ|maco"
  - name: "üá≤üáæ MY"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá≤üáæ|È©¨Êù•Ë•ø‰∫ö|È¶¨‰æÜË•ø‰∫û|malaysia"
  - name: "üáµüá≠ PH"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üáµüá≠|Ëè≤ÂæãÂÆæ|Ëè≤ÂæãË≥ì|philippines"
  - name: "üá∑üá∫ RU"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá∑üá∫|‰øÑÁΩóÊñØ|‰øÑÁæÖÊñØ|russia"
  - name: "üá∏üá¨ SG"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá∏üá¨|Êñ∞Âä†Âù°|singapore"
  - name: "üáπüáº TW"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üáπüáº|Âè∞Êπæ|Ëá∫ÁÅ£|taiwan"
  - name: "üáπüá∑ TR"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üáπüá∑|ÂúüËÄ≥ÂÖ∂|turkey"
  - name: "üá¨üáß UK"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá¨üáß|Ëã±|Ëã±Âúã|england|kingdom|britsh"
  - name: "üá∫üá∏ US"
    <<: *proxyGroupsCommon
    type: select
    filter: "(?i)üá∫üá∏|ÁæéÂõΩ|ÁæéÂúã|Ë•øÈõÖÂõæ|Ë•øÈõÖÂúñ|Ê¥õÊùâÁü∂|Ê¥õÊùâÁ£Ø|ËâæÊñØÊú¨|america|states|seattle|angeles|ashburn"
  - name: "üöò Auto"
    type: url-test
    tolerance: 100
    max-failed-times: 3
    <<: *proxyGroupsProxies
  - name: "üîô Fallback"
    type: fallback
    url: 'https://www.gstatic.com/generate_204'
    max-failed-times: 3
    <<: *proxyGroupsProxies
  - name: "üìé Relay"
    type: relay
    proxies:
      - "üá≠üá∞ HK"
      - "üá∫üá∏ US"
  - name: "ü´¥ Manual"
    type: select
    proxies:
      - "üåê DIRECT"
      - "üö´ REJECT"
      - "üá¶üá∫ AU"
      - "üá®üá¶ CA"
      - "üá©üá™ DE"
      - "üá≠üá∞ HK"
      - "üáÆüá≥ IN"
      - "üáØüáµ JP"
      - "üá∞üá∑ KR"
      - "üá≤üá¥ MA"
      - "üá≤üáæ MY"
      - "üáµüá≠ PH"
      - "üá∑üá∫ RU"
      - "üá∏üá¨ SG"
      - "üáπüáº TW"
      - "üáπüá∑ TR"
      - "üá¨üáß UK"
      - "üá∫üá∏ US"
  - name: "üîä ADS"
    type: select
    proxies:
      - "üåê DIRECT"
      - "üö´ REJECT"
      - "ü´¥ Manual"
  - name: "ü§ñ AI"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üçé Apple"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üá¨ Google"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üß™ YouTube"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ü•Ö Netflix"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üê≠ Disney"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üëå HBO"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üßôüèø‚Äç‚ôÄÔ∏è Twitch"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üê¶ Twitter"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üì≤ Telegram"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üöÇ Steam"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ü™ü Microsoft"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üìà Speedtest"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üëÇ Spotify"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "ü™ú Proxy"
    type: select
    <<: *proxyGroupsProxiesCombined
  - name: "üêü Leakage"
    type: select
    <<: *proxyGroupsProxiesCombined
#<<< Proxy Groups(Policy) Configuration End <<<

#>>> Rules Configuration End >>>
rules:
  - GEOIP,PRIVATE,üåê DIRECT
  - GEOSITE,private,üåê DIRECT
  - GEOSITE,category-ads-all,üîä ADS
  - GEOSITE,google,üá¨ Google
  - GEOSITE,youtube,üß™ YouTube
  - GEOSITE,netflix,ü•Ö Netflix
  - GEOSITE,disney,üê≠ Disney
  - GEOSITE,hbo,üëå HBO
  - GEOSITE,openai,ü§ñ AI
  - RULE-SET,claude,ü§ñ AI
  - GEOSITE,twitch,üßôüèø‚Äç‚ôÄÔ∏è Twitch
  - GEOSITE,twitter,üê¶ Twitter
  - GEOSITE,telegram,üì≤ Telegram
  - GEOSITE,speedtest,üìà Speedtest
  - GEOSITE,spotify,üëÇ Spotify
  - GEOSITE,microsoft@cn,üåê DIRECT
  - GEOSITE,microsoft,ü™ü Microsoft
  - GEOSITE,apple@cn,üåê DIRECT
  - GEOSITE,apple,üçé Apple
  - GEOSITE,steam@cn,üåê DIRECT
  - GEOSITE,steam,üöÇ Steam
  - GEOSITE,bilibili,ü´¥ Manual
  - GEOSITE,zhihu,ü´¥ Manual
  - GEOSITE,douban,ü´¥ Manual
  - GEOSITE,geolocation-!cn,ü™ú Proxy
  - GEOSITE,cn,üåê DIRECT
  - GEOIP,CN,üåê DIRECT
  - MATCH,üêü Leakage
#<<< Rules Configuration End <<<
